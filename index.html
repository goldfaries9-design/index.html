<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GoldFit (Single File)</title>
  <style>
    :root{
      --bg:#0b0b0f;
      --card:#12121a;
      --card2:#151521;
      --text:#f5f5f7;
      --muted:#b7b7c2;
      --gold:#d4af37;
      --gold2:#b78d1e;
      --border: rgba(212,175,55,.18);
      --shadow: 0 14px 48px rgba(0,0,0,.45);
      --r:18px;
    }
    [data-theme="light"]{
      --bg:#f5f3ef;
      --card:#ffffff;
      --card2:#ffffff;
      --text:#111318;
      --muted:#44495a;
      --border: rgba(183,141,30,.28);
      --shadow: 0 12px 36px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1000px 520px at 18% 0%, rgba(212,175,55,.12), transparent 60%),
        radial-gradient(900px 520px at 82% 0%, rgba(212,175,55,.09), transparent 60%),
        var(--bg);
      color:var(--text);
    }

    .topbar{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 14px;
      background: color-mix(in oklab, var(--bg) 75%, transparent);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border);
    }
    .brand{display:flex; gap:10px; align-items:center}
    .logoDot{
      width:12px;height:12px;border-radius:50%;
      background: var(--gold);
      box-shadow: 0 0 0 6px color-mix(in oklab, var(--gold) 20%, transparent);
    }
    .brandName{font-weight:900; letter-spacing:.3px; color:var(--gold)}
    .brandTag{font-size:12px; color:var(--muted)}
    .topActions{display:flex; gap:10px; align-items:center}
    .chip{
      border:1px solid color-mix(in oklab, var(--gold) 35%, transparent);
      background: color-mix(in oklab, var(--card2) 86%, transparent);
      color:var(--text);
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, border-color .12s ease, background .12s ease;
    }
    .chip:active{transform: scale(.98)}
    .chip:hover{filter:brightness(1.08)}

    .container{max-width:980px; margin:0 auto; padding:18px 14px 34px;}
    .stepper{display:flex; align-items:center; gap:10px; margin:10px 0 18px}
    .step{
      width:28px;height:28px;border-radius:50%;
      display:grid;place-items:center;
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--card2) 90%, transparent);
      color:var(--muted);
      font-weight:800;
    }
    .step.active{color:#111; background:var(--gold); border-color: transparent}
    .line{flex:1; height:2px; background: color-mix(in oklab, var(--gold) 18%, transparent)}

    .screen{animation: screenIn .22s ease both;}
    @keyframes screenIn{
      from{opacity:0; transform: translateY(10px) scale(.99)}
      to{opacity:1; transform:none}
    }
    .hidden{display:none !important}

    h1{margin:8px 0 10px; font-size:26px}
    .muted{color:var(--muted); line-height:1.6}
    .label{display:block; margin:8px 0 6px; color:var(--muted); font-size:13px}

    .input{
      width:100%;
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--card) 92%, transparent);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
    }
    .input:focus{border-color: color-mix(in oklab, var(--gold) 55%, transparent)}

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .grid3{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}

    .card,.pill,.primary,.ghost,.smallBtn{
      transition: transform .12s ease, filter .12s ease, border-color .12s ease, background .12s ease;
    }
    .card{
      text-align:inherit;
      border-radius: var(--r);
      border:1px solid var(--border);
      background: linear-gradient(180deg, color-mix(in oklab, var(--card2) 96%, transparent), color-mix(in oklab, var(--card) 92%, transparent));
      box-shadow: var(--shadow);
      padding:16px;
      cursor:pointer;
    }
    .card:hover{transform: translateY(-2px); border-color: color-mix(in oklab, var(--gold) 45%, transparent); filter:brightness(1.03)}
    .card:active{transform: scale(.98)}
    .card.selected{border-color: var(--gold)}
    .cardTitle{font-size:18px; font-weight:900}
    .cardSub{color:var(--muted); margin-top:6px}

    .panel{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius: var(--r);
      background: color-mix(in oklab, var(--card) 92%, transparent);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .panelRow{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .panelTitle{font-weight:900}

    .primary{
      border:none;
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      color:#111;
      padding:12px 16px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:900;
    }
    .primary:hover{filter:brightness(1.05)}
    .primary:active{transform: scale(.98)}

    .ghost{
      width:100%;
      margin-top:10px;
      border:1px solid var(--border);
      background: transparent;
      color:var(--text);
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
    }
    .ghost:hover{filter:brightness(1.08)}
    .ghost:active{transform: scale(.98)}

    .pill{
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--card2) 88%, transparent);
      color:var(--text);
      padding:12px 10px;
      border-radius: 999px;
      cursor:pointer;
      font-weight:800;
    }
    .pill:hover{filter:brightness(1.08)}
    .pill:active{transform: scale(.98)}
    .pill.selected{background: var(--gold); color:#111; border-color: transparent}

    .weekList{display:grid; gap:10px; margin-top:12px}
    .weekCard{
      border:1px solid var(--border);
      border-radius: var(--r);
      background: color-mix(in oklab, var(--card) 92%, transparent);
      padding:12px;
    }
    .weekHead{display:flex; justify-content:space-between; align-items:center}
    .weekDay{font-weight:900}
    .weekMeta{color:var(--muted); font-size:13px}
    .weekBtns{display:flex; gap:8px; margin-top:10px; flex-wrap:wrap}
    .smallBtn{
      border:1px solid var(--border);
      background: transparent;
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
    }
    .smallBtn:hover{filter:brightness(1.08)}
    .smallBtn:active{transform: scale(.98)}

    .playerTop{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .playerTitle{font-weight:950; font-size:18px}

    .illuBox{
      margin-top:12px;
      border:1px solid var(--border);
      border-radius: var(--r);
      background: color-mix(in oklab, var(--card2) 92%, transparent);
      box-shadow: var(--shadow);
      padding:12px;
      display:grid; place-items:center;
      overflow:hidden;
    }
    .illuBox svg{
      width:100%;
      max-width:520px;
      height:240px;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.35));
      animation: floaty 2.6s ease-in-out infinite;
      transition: opacity .18s ease, transform .18s ease;
    }
    @keyframes floaty{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-6px)}
    }
    .illuFadeOut{opacity:0; transform: translateY(8px) scale(.99)}
    .illuFadeIn{opacity:1; transform:none}

    .counterBox{margin-top:12px; text-align:center}
    .counter{font-size:56px; font-weight:1000; color:var(--gold); transition: transform .15s ease, filter .15s ease;}
    .ringWrap{display:grid; place-items:center; margin-top:6px}
    .ring{
      width: 220px; height: 220px; border-radius: 999px;
      background:
        conic-gradient(var(--gold) var(--p, 0%), color-mix(in oklab, var(--card2) 90%, transparent) 0);
      padding: 10px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: background .12s linear;
    }
    .ringInner{
      width:100%; height:100%;
      border-radius:999px;
      background: color-mix(in oklab, var(--card) 92%, transparent);
      border: 1px solid color-mix(in oklab, var(--gold) 18%, transparent);
      display:grid; place-items:center;
      padding: 14px;
    }
    .ringHint{margin-top:-6px; text-align:center; max-width: 180px}

    .pulse3{animation: pulse3 .85s ease infinite;}
    @keyframes pulse3{
      0%{transform: scale(1); filter: brightness(1)}
      50%{transform: scale(1.06); filter: brightness(1.12)}
      100%{transform: scale(1); filter: brightness(1)}
    }
    .flashDone{animation: flashDone .6s ease;}
    @keyframes flashDone{
      0%{filter: brightness(1)}
      35%{filter: brightness(1.25)}
      100%{filter: brightness(1)}
    }

    .playerControls{display:flex; gap:10px; margin-top:10px}
    .playerControls .primary{flex:1}
    .playerControls .ghost{flex:1}

    .libList{display:grid; gap:10px; margin-top:12px}
    .libItem{
      border:1px solid var(--border);
      border-radius: var(--r);
      background: color-mix(in oklab, var(--card) 92%, transparent);
      padding:12px;
    }
    .libHead{display:flex; justify-content:space-between; align-items:center; gap:10px}

    @media (max-width: 520px){
      .grid2{grid-template-columns:1fr}
      .grid3{grid-template-columns:repeat(2,1fr)}
      .panelRow{flex-direction:column; align-items:stretch}
      .playerControls{flex-direction:column}
    }
  </style>
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="logoDot"></div>
    <div>
      <div class="brandName">GoldFit</div>
      <div class="brandTag" id="brandTag">Black & Gold Training</div>
    </div>
  </div>
  <div class="topActions">
    <button class="chip" id="langBtn">AR</button>
    <button class="chip" id="themeBtn">ğŸŒ™</button>
  </div>
</header>

<main class="container">
  <div class="stepper">
    <div class="step" id="s1">1</div><div class="line"></div>
    <div class="step" id="s2">2</div><div class="line"></div>
    <div class="step" id="s3">3</div><div class="line"></div>
    <div class="step" id="s4">4</div><div class="line"></div>
    <div class="step" id="s5">5</div>
  </div>

  <!-- HOME -->
  <section class="screen" id="screen-home">
    <h1 id="homeTitle">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</h1>
    <p class="muted" id="homeSub">ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ© Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ Ù…Ø¹ Ù…Ø¤Ù‚Øª ÙˆØ±Ø³ÙˆÙ… ØªÙˆØ¶ÙŠØ­ÙŠØ© ÙˆØ®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.</p>

    <div class="grid2">
      <button class="card" id="btnMen" type="button">
        <div class="cardTitle" id="menTitle">Ø±Ø¬Ø§Ù„</div>
        <div class="cardSub" id="menSub">Men programs</div>
      </button>
      <button class="card" id="btnWomen" type="button">
        <div class="cardTitle" id="womenTitle">Ù†Ø³Ø§Ø¡</div>
        <div class="cardSub" id="womenSub">Women programs</div>
      </button>
    </div>

    <div class="panel">
      <div class="panelRow">
        <div>
          <div class="panelTitle" id="quickTitle">Ø³Ø±ÙŠØ¹</div>
          <div class="muted" id="quickSub">ØªÙ…Ø±ÙŠÙ† 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¢Ù†</div>
        </div>
        <button class="primary" id="quickStartBtn" type="button">Ø§Ø¨Ø¯Ø£</button>
      </div>
    </div>

    <div class="panel">
      <div class="panelRow">
        <div>
          <div class="panelTitle" id="continueTitle">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ®Ø·ÙŠØ·</div>
          <div class="muted" id="continueSub">Ø§Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ®Ø° Ø®Ø·Ø©</div>
        </div>
        <button class="primary" id="goProfileBtn" type="button">Ø§Ø¨Ø¯Ø£</button>
      </div>
    </div>
  </section>

  <!-- PROFILE -->
  <section class="screen hidden" id="screen-profile">
    <h1 id="profileTitle">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø³Ù…</h1>

    <div class="panel">
      <div class="grid2">
        <div>
          <label class="label" id="heightLabel" for="heightCm">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
          <input class="input" id="heightCm" type="number" inputmode="numeric" placeholder="170">
        </div>
        <div>
          <label class="label" id="weightLabel" for="weightKg">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label>
          <input class="input" id="weightKg" type="number" inputmode="numeric" placeholder="70">
        </div>
      </div>

      <div class="grid2">
        <div>
          <label class="label" id="ageLabel" for="age">Ø§Ù„Ø¹Ù…Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input class="input" id="age" type="number" inputmode="numeric" placeholder="22">
        </div>
        <div>
          <label class="label" id="levelLabel" for="level">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
          <select class="input" id="level">
            <option value="beginner">Ù…Ø¨ØªØ¯Ø¦</option>
            <option value="intermediate">Ù…ØªÙˆØ³Ø·</option>
            <option value="advanced">Ù…ØªÙ‚Ø¯Ù…</option>
          </select>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label class="label" id="injuryLabel" for="injury">Ø£Ù„Ù…/Ø¥ØµØ§Ø¨Ø©</label>
          <select class="input" id="injury">
            <option value="none">Ù„Ø§</option>
            <option value="knee">Ø±ÙƒØ¨Ø©</option>
            <option value="back">Ø¸Ù‡Ø±</option>
            <option value="shoulder">ÙƒØªÙ</option>
            <option value="wrist">Ø±Ø³Øº</option>
          </select>
        </div>
        <div>
          <label class="label" id="activityLabel" for="activity">Ù†Ø´Ø§Ø· ÙŠÙˆÙ…ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <select class="input" id="activity">
            <option value="low">Ù‚Ù„ÙŠÙ„</option>
            <option value="mid">Ù…ØªÙˆØ³Ø·</option>
            <option value="high">Ø¹Ø§Ù„ÙŠ</option>
          </select>
        </div>
      </div>

      <div class="panelRow">
        <div>
          <div class="panelTitle" id="bmiTitle">BMI</div>
          <div class="muted" id="bmiText">â€”</div>
        </div>
        <button class="primary" id="goGoalBtn" type="button">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </div>

    <button class="ghost" id="backHome1" type="button">Ø±Ø¬ÙˆØ¹</button>
  </section>

  <!-- GOAL -->
  <section class="screen hidden" id="screen-goal">
    <h1 id="goalTitle">Ø§Ø®ØªØ± Ù‡Ø¯ÙÙƒ</h1>

    <div class="grid2">
      <button class="card goal" data-goal="fat_loss" type="button"><div class="cardTitle" id="gFatT">ØªÙ†Ø´ÙŠÙ</div><div class="cardSub">Fat loss</div></button>
      <button class="card goal" data-goal="muscle_gain" type="button"><div class="cardTitle" id="gMuscleT">ØªØ¹Ø¶ÙŠÙ„</div><div class="cardSub">Muscle</div></button>
      <button class="card goal" data-goal="cardio" type="button"><div class="cardTitle" id="gCardioT">Ù‡ÙˆØ§Ø¦ÙŠ</div><div class="cardSub">Cardio</div></button>
      <button class="card goal" data-goal="mobility" type="button"><div class="cardTitle" id="gMobT">Ù…Ø±ÙˆÙ†Ø©</div><div class="cardSub">Mobility</div></button>
      <button class="card goal" data-goal="stretching" type="button"><div class="cardTitle" id="gStretchT">ØªÙ…Ø¯Ø¯</div><div class="cardSub">Stretch</div></button>
      <button class="card goal" data-goal="maintain" type="button"><div class="cardTitle" id="gMaintainT">Ù…Ø­Ø§ÙØ¸Ø©</div><div class="cardSub">Maintain</div></button>
    </div>

    <div class="panel">
      <div class="grid2">
        <div>
          <label class="label" id="durationLabel" for="duration">Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</label>
          <select class="input" id="duration">
            <option value="10">10 min</option>
            <option value="20" selected>20 min</option>
            <option value="30">30 min</option>
            <option value="45">45 min</option>
          </select>
        </div>
        <div>
          <label class="label" id="daysLabel" for="days">Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
          <select class="input" id="days">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label class="label" id="modeLabel" for="mode">ÙˆØ¶Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</label>
          <select class="input" id="mode">
            <option value="timer" selected>Timer</option>
            <option value="reps">Reps</option>
          </select>
        </div>
        <div>
          <label class="label" id="impactLabel" for="impact">Ø§Ù„Ø­ÙØ¯Ø©/Ø§Ù„Ù‚ÙØ²</label>
          <select class="input" id="impact">
            <option value="auto" selected>Auto</option>
            <option value="low">Low impact</option>
            <option value="normal">Normal</option>
          </select>
        </div>
      </div>

      <div class="panelRow">
        <div>
          <div class="panelTitle" id="goalChosenTitle">Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
          <div class="muted" id="goalChosenText">â€”</div>
        </div>
        <button class="primary" id="goTargetBtn" type="button">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </div>

    <button class="ghost" id="backHome2" type="button">Ø±Ø¬ÙˆØ¹</button>
  </section>

  <!-- TARGET -->
  <section class="screen hidden" id="screen-target">
    <h1 id="targetTitle">Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h1>

    <div class="grid3">
      <button class="pill target" data-target="full_body" id="tFull" type="button">ÙƒØ§Ù…Ù„ Ø§Ù„Ø¬Ø³Ù…</button>
      <button class="pill target" data-target="core" type="button">Ø¨Ø·Ù†</button>
      <button class="pill target" data-target="chest" type="button">ØµØ¯Ø±</button>
      <button class="pill target" data-target="back" type="button">Ø¸Ù‡Ø±</button>
      <button class="pill target" data-target="shoulders" type="button">ÙƒØªÙ</button>
      <button class="pill target" data-target="arms" type="button">Ø°Ø±Ø§Ø¹</button>
      <button class="pill target" data-target="legs" type="button">Ø£Ø±Ø¬Ù„</button>
      <button class="pill target" data-target="glutes" type="button">Ù…Ø¤Ø®Ø±Ø©</button>
    </div>

    <div class="panel">
      <div class="grid2">
        <div>
          <label class="label" id="typeLabel" for="workoutType">Ù†ÙˆØ¹ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</label>
          <select class="input" id="workoutType">
            <option value="mix" selected>Mix</option>
            <option value="bodyweight">Bodyweight</option>
            <option value="cardio">Cardio</option>
            <option value="stretching">Stretching</option>
          </select>
        </div>
        <div>
          <label class="label" id="equipmentLabel" for="equipment">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</label>
          <select class="input" id="equipment">
            <option value="none" selected>Ø¨Ø¯ÙˆÙ† Ø¹Ø¯Ø©</option>
          </select>
        </div>
      </div>

      <div class="panelRow">
        <div>
          <div class="panelTitle" id="planTitle">Ø§Ù„Ø®Ø·Ø©</div>
          <div class="muted" id="planSub">ØªÙˆÙ„ÙŠØ¯ Ø®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© + ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
        </div>
        <button class="primary" id="generateBtn" type="button">ØªÙˆÙ„ÙŠØ¯</button>
      </div>
    </div>

    <button class="ghost" id="backGoal" type="button">Ø±Ø¬ÙˆØ¹</button>
  </section>

  <!-- PLAN -->
  <section class="screen hidden" id="screen-plan">
    <h1 id="planHeader">Ø®Ø·Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h1>

    <div class="panel">
      <div class="panelRow">
        <div>
          <div class="panelTitle" id="todayTitle">ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
          <div class="muted" id="todaySub">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡</div>
        </div>
        <button class="primary" id="startTodayBtn" type="button">Ø§Ø¨Ø¯Ø£</button>
      </div>
    </div>

    <div class="panel">
      <div class="panelRow">
        <div>
          <div class="panelTitle" id="streakTitle">Streak</div>
          <div class="muted" id="streakText">â€”</div>
        </div>
        <button class="chip" id="logBtn" type="button">ØªØ³Ø¬ÙŠÙ„ âœ…</button>
      </div>
    </div>

    <div id="weekList" class="weekList"></div>

    <div class="panel">
      <div class="panelRow">
        <button class="ghost" id="editBtn" type="button">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</button>
        <button class="ghost" id="libraryBtn" type="button">Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
      </div>
    </div>
  </section>

  <!-- PLAYER -->
  <section class="screen hidden" id="screen-player">
    <div class="playerTop">
      <div>
        <div class="playerTitle" id="playerExerciseName">â€”</div>
        <div class="muted" id="playerMeta">â€”</div>
      </div>
      <button class="chip" id="swapBtn" type="button">Ø¨Ø¯Ù‘Ù„</button>
    </div>

    <div class="illuBox" id="illuBox">
      <div id="playerIllu"></div>
    </div>

    <div class="counterBox">
      <div class="ringWrap">
        <div class="ring" id="ring">
          <div class="ringInner">
            <div class="counter" id="counter">0</div>
            <div class="muted ringHint" id="counterHint">â€”</div>
          </div>
        </div>
      </div>
    </div>

    <div class="playerControls">
      <button class="primary" id="playBtn" type="button">Ø§Ø¨Ø¯Ø£</button>
      <button class="ghost" id="nextBtn" type="button">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      <button class="ghost" id="stopBtn" type="button">Ø¥ÙŠÙ‚Ø§Ù</button>
    </div>

    <div class="panel">
      <div class="panelRow">
        <div>
          <div class="panelTitle" id="tipsTitle">Ù†ØµØ§Ø¦Ø­</div>
          <div class="muted" id="tipsText">â€”</div>
        </div>
      </div>
    </div>

    <button class="ghost" id="backPlan" type="button">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø·Ø©</button>
  </section>

  <!-- LIBRARY -->
  <section class="screen hidden" id="screen-library">
    <h1 id="libTitle">Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</h1>

    <div class="panel">
      <div class="grid2">
        <div>
          <label class="label" id="libGoalLabel" for="libGoal">Ù‡Ø¯Ù</label>
          <select class="input" id="libGoal"></select>
        </div>
        <div>
          <label class="label" id="libTargetLabel" for="libTarget">Ù…Ù†Ø·Ù‚Ø©</label>
          <select class="input" id="libTarget"></select>
        </div>
      </div>
      <div class="grid2">
        <div>
          <label class="label" id="libTypeLabel" for="libType">Ù†ÙˆØ¹</label>
          <select class="input" id="libType"></select>
        </div>
        <div>
          <label class="label" id="libLevelLabel" for="libLevel">Ù…Ø³ØªÙˆÙ‰</label>
          <select class="input" id="libLevel"></select>
        </div>
      </div>
      <button class="primary" id="libApply" type="button">Apply</button>
    </div>

    <div id="libList" class="libList"></div>

    <button class="ghost" id="backPlan2" type="button">Ø±Ø¬ÙˆØ¹</button>
  </section>
</main>

<script>
/* =========================
   GoldFit Single-File App
   ========================= */

const $ = (id)=>document.getElementById(id);
const screens = ["screen-home","screen-profile","screen-goal","screen-target","screen-plan","screen-player","screen-library"];

const state = {
  lang:"ar",
  theme:"dark",
  section:null, // men | women
  profile:{heightCm:null, weightKg:null, age:null, level:"beginner", injury:"none", activity:"low", bmi:null, bmiFlag:"normal"},
  prefs:{goal:null, duration:20, days:4, mode:"timer", impact:"auto", target:"full_body", type:"mix", equipment:"none"},
  weekPlan:[],
  todayIndex:0,
  player:{workout:[], idx:0, running:false, timer:null, remaining:0, phase:"work", totalPhase:0},
};

const I18N = {
  ar:{
    brandTag:"Black & Gold Training",
    homeTitle:"Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…",
    homeSub:"ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ© Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ Ù…Ø¹ Ù…Ø¤Ù‚Øª ÙˆØ±Ø³ÙˆÙ… ØªÙˆØ¶ÙŠØ­ÙŠØ© ÙˆØ®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.",
    menTitle:"Ø±Ø¬Ø§Ù„", menSub:"Men programs",
    womenTitle:"Ù†Ø³Ø§Ø¡", womenSub:"Women programs",
    quickTitle:"Ø³Ø±ÙŠØ¹", quickSub:"ØªÙ…Ø±ÙŠÙ† 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¢Ù†",
    continueTitle:"Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ®Ø·ÙŠØ·", continueSub:"Ø§Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ®Ø° Ø®Ø·Ø©",
    profileTitle:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø³Ù…",
    heightLabel:"Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)", weightLabel:"Ø§Ù„ÙˆØ²Ù† (ÙƒØº)", ageLabel:"Ø§Ù„Ø¹Ù…Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
    levelLabel:"Ø§Ù„Ù…Ø³ØªÙˆÙ‰", injuryLabel:"Ø£Ù„Ù…/Ø¥ØµØ§Ø¨Ø©", activityLabel:"Ù†Ø´Ø§Ø· ÙŠÙˆÙ…ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
    bmiTitle:"BMI",
    goalTitle:"Ø§Ø®ØªØ± Ù‡Ø¯ÙÙƒ",
    durationLabel:"Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©", daysLabel:"Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
    modeLabel:"ÙˆØ¶Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠÙ†", impactLabel:"Ø§Ù„Ø­ÙØ¯Ø©/Ø§Ù„Ù‚ÙØ²",
    goalChosenTitle:"Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±",
    targetTitle:"Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
    typeLabel:"Ù†ÙˆØ¹ Ø§Ù„ØªÙ…Ø±ÙŠÙ†", equipmentLabel:"Ø§Ù„Ù…Ø¹Ø¯Ø§Øª",
    planHeader:"Ø®Ø·Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
    todayTitle:"ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…", todaySub:"Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡",
    streakTitle:"Streak",
    tipsTitle:"Ù†ØµØ§Ø¦Ø­",
    libTitle:"Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†",
    btnStart:"Ø§Ø¨Ø¯Ø£", btnNext:"Ø§Ù„ØªØ§Ù„ÙŠ", btnStop:"Ø¥ÙŠÙ‚Ø§Ù",
    btnBack:"Ø±Ø¬ÙˆØ¹", btnBackPlan:"Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø·Ø©",
    edit:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª", library:"Ø§Ù„Ù…ÙƒØªØ¨Ø©", swap:"Ø¨Ø¯Ù‘Ù„",
    generate:"ØªÙˆÙ„ÙŠØ¯",
    log:"ØªØ³Ø¬ÙŠÙ„ âœ…",
    chooseGoal:"Ø§Ø®ØªØ± Ù‡Ø¯Ù",
  },
  en:{
    brandTag:"Black & Gold Training",
    homeTitle:"Choose section",
    homeSub:"Personalized workouts with timer, visuals, and weekly plan.",
    menTitle:"Men", menSub:"Men programs",
    womenTitle:"Women", womenSub:"Women programs",
    quickTitle:"Quick", quickSub:"5-minute workout now",
    continueTitle:"Start planning", continueSub:"Enter your stats and get a plan",
    profileTitle:"Body profile",
    heightLabel:"Height (cm)", weightLabel:"Weight (kg)", ageLabel:"Age (optional)",
    levelLabel:"Level", injuryLabel:"Pain/Injury", activityLabel:"Daily activity (optional)",
    bmiTitle:"BMI",
    goalTitle:"Choose your goal",
    durationLabel:"Session length", daysLabel:"Days/week",
    modeLabel:"Workout mode", impactLabel:"Impact/jumping",
    goalChosenTitle:"Selection",
    targetTitle:"Target area",
    typeLabel:"Workout type", equipmentLabel:"Equipment",
    planHeader:"Weekly plan",
    todayTitle:"Today", todaySub:"Ready to start",
    streakTitle:"Streak",
    tipsTitle:"Tips",
    libTitle:"Exercise library",
    btnStart:"Start", btnNext:"Next", btnStop:"Stop",
    btnBack:"Back", btnBackPlan:"Back to plan",
    edit:"Edit choices", library:"Library", swap:"Swap",
    generate:"Generate",
    log:"Log âœ…",
    chooseGoal:"Choose a goal",
  }
};

// ====== Exercise library (expanded starter set) ======
// (ØªÙ‚Ø¯Ø± ØªØ²ÙŠØ¯/ØªØ¹Ø¯Ù„ Ù„Ø§Ø­Ù‚Ù‹Ø§)
const EX = [
  // --- FULL BODY / CARDIO ---
  ex("jumping_jacks","Ù‚ÙØ² Ø§Ù„Ù†Ø¬Ù…Ø©","Jumping Jacks",["fat_loss","cardio","maintain"],["full_body"],"cardio",["beginner","intermediate","advanced"],"high",["knee"], cfg({work:30,rest:15,rounds:4}), tips("Ù‡Ø¨ÙˆØ· Ù†Ø§Ø¹Ù…ØŒ ØªÙ†ÙØ³ Ù…Ù†ØªØ¸Ù….","Soft landing, steady breathing."), illu.jacks),
  ex("march_in_place","Ù…Ø´ÙŠ Ø¨Ø§Ù„Ù…ÙƒØ§Ù†","March in Place",["fat_loss","cardio","maintain"],["full_body"],"cardio",["beginner","intermediate","advanced"],"low",[], cfg({work:40,rest:20,rounds:3}), tips("Ø§Ø±ÙØ¹ Ø§Ù„Ø±ÙƒØ¨Ø© Ø¨Ù‚Ø¯Ø± Ø±Ø§Ø­ØªÙƒØŒ Ø¸Ù‡Ø± Ù…Ø³ØªÙ‚ÙŠÙ….","Lift knees comfortably, tall posture."), illu.march),
  ex("mountain_climbers","Ù…ØªØ³Ù„Ù‚ Ø§Ù„Ø¬Ø¨Ù„","Mountain Climbers",["fat_loss","cardio"],["core","full_body","shoulders"],"cardio",["intermediate","advanced"],"high",["wrist","shoulder"], cfg({work:30,rest:20,rounds:3}), tips("Ø´Ø¯ Ø§Ù„Ø¨Ø·Ù†ØŒ Ù„Ø§ ØªØ±ÙØ¹ Ø§Ù„Ø­ÙˆØ¶ ÙƒØ«ÙŠØ±.","Brace core, avoid bouncing hips."), illu.climbers),
  ex("burpee_low","Ø¨ÙŠØ±Ø¨ÙŠ (Ø®ÙÙŠÙ)","Burpee (Low)",["fat_loss","cardio"],["full_body"],"cardio",["intermediate","advanced"],"high",["knee","back"], cfg({work:20,rest:25,rounds:4}), tips("Ø§Ø®ØªØµØ± Ø§Ù„Ù‚ÙØ² Ø¥Ø°Ø§ Ø­ÙØ¯Ø© Ø¹Ø§Ù„ÙŠØ©.","Skip jump if needed."), illu.burpee),

  // --- CHEST/ARMS/SHOULDERS ---
  ex("push_up","Ø¶ØºØ·","Push-Up",["muscle_gain","maintain"],["chest","arms","shoulders","core"],"bodyweight",["beginner","intermediate","advanced"],"low",["wrist","shoulder"], cfg({reps:10,sets:3,work:30,rest:30}), tips("Ø´Ø¯ Ø§Ù„Ø¨Ø·Ù†ØŒ Ø¸Ù‡Ø± Ù…Ø³ØªÙ‚ÙŠÙ….","Brace core, keep body straight."), illu.pushup),
  ex("incline_push_up","Ø¶ØºØ· Ù…Ø§Ø¦Ù„ (Ø£Ø³Ù‡Ù„)","Incline Push-Up",["muscle_gain","maintain"],["chest","arms","core"],"bodyweight",["beginner","intermediate"],"low",["wrist"], cfg({reps:12,sets:3,work:30,rest:30}), tips("Ø§Ø³ØªØ®Ø¯Ù… Ø³Ø·Ø­ Ø«Ø§Ø¨Øª.","Use a stable surface."), illu.inclinePush),
  ex("pike_push","Ø¶ØºØ· Ø¨Ø§ÙŠÙƒ (ÙƒØªÙ)","Pike Push-Up",["muscle_gain","maintain"],["shoulders","arms","core"],"bodyweight",["intermediate","advanced"],"low",["wrist","shoulder"], cfg({reps:8,sets:3,work:25,rest:35}), tips("Ø§Ø±ÙØ¹ Ø§Ù„Ø­ÙˆØ¶ØŒ Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªÙ.","Hips high, focus shoulders."), illu.pike),

  // --- BACK/CORE ---
  ex("plank","Ø¨Ù„Ø§Ù†Ùƒ","Plank",["fat_loss","maintain","cardio"],["core","shoulders"],"bodyweight",["beginner","intermediate","advanced"],"low",["back","shoulder"], cfg({work:30,rest:20,rounds:3}), tips("Ù„Ø§ ØªÙ‡Ø¨Ø· Ø§Ù„Ø­ÙˆØ¶ØŒ ØªÙ†ÙÙ‘Ø³.","Donâ€™t sag hips, breathe."), illu.plank),
  ex("side_plank","Ø¨Ù„Ø§Ù†Ùƒ Ø¬Ø§Ù†Ø¨ÙŠ","Side Plank",["maintain","mobility"],["core"],"bodyweight",["intermediate","advanced"],"low",["shoulder"], cfg({work:25,rest:20,rounds:3}), tips("Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø®Ø· Ù…Ø³ØªÙ‚ÙŠÙ….","Keep a straight line."), illu.sidePlank),
  ex("dead_bug","Ø¯ÙŠØ¯ Ø¨ÙØº","Dead Bug",["maintain","mobility"],["core"],"bodyweight",["beginner","intermediate"],"low",["back"], cfg({reps:10,sets:3,work:30,rest:20}), tips("Ø£Ø³ÙÙ„ Ø§Ù„Ø¸Ù‡Ø± Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶.","Lower back stays on floor."), illu.deadBug),
  ex("superman","Ø³ÙˆØ¨Ø±Ù…Ø§Ù†","Superman",["maintain","muscle_gain"],["back","glutes"],"bodyweight",["beginner","intermediate","advanced"],"low",["back"], cfg({reps:10,sets:3,work:25,rest:25}), tips("Ø§Ø±ÙØ¹ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ Ø¨Ø¯ÙˆÙ† Ø£Ù„Ù….","Lift gently, no pain."), illu.superman),

  // --- LEGS/GLUTES ---
  ex("squat","Ø³ÙƒÙˆØ§Øª","Squat",["fat_loss","muscle_gain","maintain"],["legs","glutes","core"],"bodyweight",["beginner","intermediate","advanced"],"low",["knee"], cfg({reps:12,sets:3,work:35,rest:25}), tips("Ø§Ù„Ø±ÙƒØ¨ Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø£ØµØ§Ø¨Ø¹.","Knees track toes."), illu.squat),
  ex("lunge_alt","Ù„Ø§Ù†Ø¬ ØªØ¨Ø§Ø¯Ù„ÙŠ","Alternating Lunge",["fat_loss","muscle_gain","maintain"],["legs","glutes"],"bodyweight",["intermediate","advanced"],"low",["knee"], cfg({reps:10,sets:3,work:35,rest:30}), tips("Ø®Ø·ÙˆØ© Ù…ØªÙˆØ³Ø·Ø©ØŒ Ø¸Ù‡Ø± Ù…Ø³ØªÙ‚ÙŠÙ….","Medium step, tall torso."), illu.lunge),
  ex("glute_bridge","Ø¬Ø³Ø± Ø§Ù„Ù…Ø¤Ø®Ø±Ø©","Glute Bridge",["muscle_gain","maintain"],["glutes","core"],"bodyweight",["beginner","intermediate","advanced"],"low",["back"], cfg({reps:12,sets:3,work:30,rest:25}), tips("Ø§Ø¹ØµØ± Ø§Ù„Ù…Ø¤Ø®Ø±Ø© Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰.","Squeeze glutes at top."), illu.bridge),
  ex("wall_sit","Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ø¦Ø·","Wall Sit",["fat_loss","maintain"],["legs"],"bodyweight",["beginner","intermediate","advanced"],"low",["knee"], cfg({work:30,rest:25,rounds:3}), tips("Ø²Ø§ÙˆÙŠØ© 90Â° Ø£Ùˆ Ø£Ù‚Ù„ Ø­Ø³Ø¨ Ø±Ø§Ø­ØªÙƒ.","Aim ~90Â° as tolerated."), illu.wallSit),

  // --- MOBILITY/STRETCH ---
  ex("cat_cow","ÙƒØ§Øª-ÙƒØ§Ùˆ","Cat-Cow",["mobility","stretching"],["back","core"],"stretching",["beginner","intermediate","advanced"],"low",[], cfg({work:45,rest:15,rounds:2}), tips("Ø´Ù‡ÙŠÙ‚ ÙØªØ­ Ø§Ù„ØµØ¯Ø±ØŒ Ø²ÙÙŠØ± ØªÙ‚ÙˆÙŠØ³ Ø§Ù„Ø¸Ù‡Ø±.","Inhale open chest, exhale round."), illu.catCow),
  ex("hamstring","ØªÙ…Ø¯Ø¯ Ø§Ù„Ø®Ù„ÙÙŠØ©","Hamstring Stretch",["stretching","mobility"],["legs"],"stretching",["beginner","intermediate","advanced"],"low",[], cfg({work:40,rest:15,rounds:2}), tips("Ù„Ø§ ØªÙ‚ÙØ²ØŒ Ø®Ù„Ùƒ Ø«Ø§Ø¨Øª.","No bouncing, hold steady."), illu.hamstring),
  ex("hip_flexor","ØªÙ…Ø¯Ø¯ Ø§Ù„ÙØ®Ø° Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ","Hip Flexor Stretch",["stretching","mobility"],["legs","glutes"],"stretching",["beginner","intermediate","advanced"],"low",[], cfg({work:40,rest:15,rounds:2}), tips("Ø´Ø¯ Ø§Ù„Ù…Ø¤Ø®Ø±Ø© Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ·.","Squeeze glutes to reduce strain."), illu.hipFlex),
];

function ex(id, ar, en, goals, targets, type, level, impact, avoid_if, defaults, tips, illustration){
  return {id, name_ar:ar, name_en:en, goals, targets, type, level, impact, avoid_if, defaults, tips_ar:tips.ar, tips_en:tips.en, illustration};
}
function cfg({reps=10,sets=3,work=30,rest=20,rounds=3}){
  return {reps,sets,work_sec:work,rest_sec:rest,rounds};
}
function tips(ar,en){ return {ar,en}; }

/* ===== Inline SVG illustrations (animated) ===== */
const illu = {
  pushup: svgPushUp(),
  inclinePush: svgInclinePushUp(),
  pike: svgPikePush(),
  squat: svgSquat(),
  lunge: svgLunge(),
  bridge: svgBridge(),
  wallSit: svgWallSit(),
  plank: svgPlank(),
  sidePlank: svgSidePlank(),
  deadBug: svgDeadBug(),
  superman: svgSuperman(),
  jacks: svgJacks(),
  march: svgMarch(),
  climbers: svgClimbers(),
  burpee: svgBurpee(),
  catCow: svgCatCow(),
  hamstring: svgHamstring(),
  hipFlex: svgHipFlexor(),
};

function svgWrap(inner){
  return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 260">
    <defs>
      <linearGradient id="g" x1="0" x2="1">
        <stop offset="0" stop-color="#d4af37" stop-opacity="1"/>
        <stop offset="1" stop-color="#b78d1e" stop-opacity="1"/>
      </linearGradient>
    </defs>
    <rect x="1" y="1" width="638" height="258" rx="22" fill="none" stroke="rgba(212,175,55,.18)" />
    ${inner}
  </svg>`;
}
function stickman(x,y,scale=1){
  const s=scale;
  return `
    <g transform="translate(${x} ${y}) scale(${s})" stroke="url(#g)" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="0" cy="-42" r="16"/>
      <line x1="0" y1="-26" x2="0" y2="40"/>
      <line x1="0" y1="0" x2="-28" y2="18"/>
      <line x1="0" y1="0" x2="28" y2="18"/>
      <line x1="0" y1="40" x2="-20" y2="85"/>
      <line x1="0" y1="40" x2="20" y2="85"/>
    </g>`;
}

// A few custom animated SVGs
function svgPushUp(){
  return svgWrap(`
    <g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="140" cy="140" r="16">
        <animate attributeName="cy" values="140;155;140" dur="1.2s" repeatCount="indefinite"/>
      </circle>
      <path d="M156 150 L320 175 L520 195">
        <animate attributeName="d" values="M156 150 L320 175 L520 195;M156 165 L320 190 L520 205;M156 150 L320 175 L520 195" dur="1.2s" repeatCount="indefinite"/>
      </path>
      <line x1="240" y1="182" x2="228" y2="240">
        <animate attributeName="y1" values="182;197;182" dur="1.2s" repeatCount="indefinite"/>
      </line>
      <line x1="280" y1="188" x2="292" y2="240">
        <animate attributeName="y1" values="188;203;188" dur="1.2s" repeatCount="indefinite"/>
      </line>
      <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
    </g>
  `);
}
function svgInclinePushUp(){
  return svgWrap(`
    <g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
      <rect x="470" y="110" width="120" height="90" rx="16" opacity=".9"/>
      <circle cx="150" cy="150" r="16"/>
      <path d="M166 160 L430 195 L520 195"/>
      <line x1="320" y1="186" x2="305" y2="240"/>
      <line x1="355" y1="190" x2="365" y2="240"/>
      <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
    </g>
  `);
}
function svgSquat(){
  return svgWrap(`
    <g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="320" cy="70" r="16">
        <animate attributeName="cy" values="70;92;70" dur="1.2s" repeatCount="indefinite"/>
      </circle>
      <line x1="320" y1="86" x2="320" y2="150">
        <animate attributeName="y2" values="150;170;150" dur="1.2s" repeatCount="indefinite"/>
      </line>
      <polyline points="320,150 280,220 240,220">
        <animate attributeName="points" values="320,150 280,220 240,220;320,170 300,220 270,220;320,150 280,220 240,220" dur="1.2s" repeatCount="indefinite"/>
      </polyline>
      <polyline points="320,150 360,220 400,220">
        <animate attributeName="points" values="320,150 360,220 400,220;320,170 340,220 370,220;320,150 360,220 400,220" dur="1.2s" repeatCount="indefinite"/>
      </polyline>
      <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
    </g>
  `);
}
function svgPlank(){
  return svgWrap(`
    <g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="170" cy="150" r="16"/>
      <path d="M186 160 L410 185 L540 210"/>
      <line x1="270" y1="175" x2="255" y2="240"/>
      <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
    </g>
  `);
}
function svgJacks(){
  return svgWrap(`
    <g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="320" cy="70" r="16">
        <animate attributeName="cy" values="70;66;70" dur=".8s" repeatCount="indefinite"/>
      </circle>
      <line x1="320" y1="86" x2="320" y2="160"/>
      <polyline points="320,115 250,80 220,55">
        <animate attributeName="points" values="320,115 250,80 220,55;320,115 285,105 260,110;320,115 250,80 220,55" dur=".8s" repeatCount="indefinite"/>
      </polyline>
      <polyline points="320,115 390,80 420,55">
        <animate attributeName="points" values="320,115 390,80 420,55;320,115 355,105 380,110;320,115 390,80 420,55" dur=".8s" repeatCount="indefinite"/>
      </polyline>
      <polyline points="320,160 260,235 230,235">
        <animate attributeName="points" values="320,160 260,235 230,235;320,160 290,235 260,235;320,160 260,235 230,235" dur=".8s" repeatCount="indefinite"/>
      </polyline>
      <polyline points="320,160 380,235 410,235">
        <animate attributeName="points" values="320,160 380,235 410,235;320,160 350,235 380,235;320,160 380,235 410,235" dur=".8s" repeatCount="indefinite"/>
      </polyline>
      <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
    </g>
  `);
}
function svgCatCow(){
  return svgWrap(`
    <g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="210" cy="120" r="14"/>
      <path d="M235 140 Q320 110 405 140">
        <animate attributeName="d" values="M235 140 Q320 110 405 140;M235 140 Q320 170 405 140;M235 140 Q320 110 405 140" dur="1.4s" repeatCount="indefinite"/>
      </path>
      <line x1="250" y1="150" x2="235" y2="240"/>
      <line x1="390" y1="150" x2="405" y2="240"/>
      <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
    </g>
  `);
}

// small/simple ones:
function svgLunge(){ return svgWrap(`${stickman(320,130,1)}<line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>`); }
function svgBridge(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <path d="M170 200 Q320 130 470 200"><animate attributeName="d" values="M170 200 Q320 130 470 200;M170 200 Q320 150 470 200;M170 200 Q320 130 470 200" dur="1.2s" repeatCount="indefinite"/></path>
  <circle cx="150" cy="200" r="14"/>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgWallSit(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <line x1="470" y1="60" x2="470" y2="240" opacity=".8"/>
  ${stickman(360,150,1)}
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgSidePlank(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="220" cy="170" r="14"/><path d="M234 178 L420 195 L520 220"/>
  <line x1="310" y1="188" x2="295" y2="240"/>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgDeadBug(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="320" cy="160" r="14"/>
  <line x1="320" y1="174" x2="320" y2="215"/>
  <line x1="320" y1="190" x2="270" y2="165"><animate attributeName="x2" values="270;240;270" dur="1.2s" repeatCount="indefinite"/></line>
  <line x1="320" y1="200" x2="370" y2="175"><animate attributeName="x2" values="370;400;370" dur="1.2s" repeatCount="indefinite"/></line>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgSuperman(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="210" cy="180" r="14"/>
  <path d="M225 188 L420 200 L520 210"><animate attributeName="d" values="M225 188 L420 200 L520 210;M225 175 L420 185 L520 198;M225 188 L420 200 L520 210" dur="1.2s" repeatCount="indefinite"/></path>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgMarch(){ return svgWrap(`${stickman(320,130,1)}<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="320" cy="88" r="0">
    <animate attributeName="r" values="0;0;0" dur="1s" repeatCount="indefinite"/>
  </circle>
</g><line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>`); }
function svgClimbers(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="170" cy="150" r="16"/>
  <path d="M186 160 L410 185 L540 210"/>
  <line x1="300" y1="190" x2="270" y2="240"><animate attributeName="x2" values="270;330;270" dur=".8s" repeatCount="indefinite"/></line>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgBurpee(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="210" cy="140" r="16"><animate attributeName="cy" values="140;105;140" dur="1.1s" repeatCount="indefinite"/></circle>
  <path d="M226 150 L360 175 L520 205"><animate attributeName="d" values="M226 150 L360 175 L520 205;M226 120 L360 145 L520 175;M226 150 L360 175 L520 205" dur="1.1s" repeatCount="indefinite"/></path>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgHamstring(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">${stickman(260,140,1)}
  <path d="M320 200 Q420 170 520 140" opacity=".7"/>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgHipFlexor(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">${stickman(320,140,1)}
  <path d="M240 220 Q320 180 400 220" opacity=".7"/>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }
function svgPikePush(){ return svgWrap(`<g stroke="url(#g)" stroke-width="10" fill="none" stroke-linecap="round">
  <circle cx="220" cy="150" r="16"/>
  <path d="M236 160 L320 120 L470 190"><animate attributeName="d" values="M236 160 L320 120 L470 190;M236 170 L320 140 L470 200;M236 160 L320 120 L470 190" dur="1.2s" repeatCount="indefinite"/></path>
  <line x1="40" y1="240" x2="600" y2="240" opacity=".25"/>
</g>`); }

// ====== storage (optional) ======
const LS_KEY="goldfit_single_v1";
const LS_LOG="goldfit_log_v1";

function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify({
    lang:state.lang, theme:state.theme, section:state.section,
    profile:state.profile, prefs:state.prefs, weekPlan:state.weekPlan, todayIndex:state.todayIndex
  }));
}
function loadState(){
  const raw=localStorage.getItem(LS_KEY);
  if(!raw) return;
  try{
    const s=JSON.parse(raw);
    Object.assign(state, s);
  }catch(e){}
}
function todayKey(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
}
function logCompletion(){
  const raw=localStorage.getItem(LS_LOG);
  const log=raw?JSON.parse(raw):{};
  log[todayKey()]=true;
  localStorage.setItem(LS_LOG, JSON.stringify(log));
  $("streakText").textContent = `${getStreak()} day(s)`;
}
function getStreak(){
  const raw=localStorage.getItem(LS_LOG);
  const log=raw?JSON.parse(raw):{};
  let streak=0;
  for(let i=0;i<365;i++){
    const d=new Date(); d.setDate(d.getDate()-i);
    const k=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    if(log[k]) streak++; else break;
  }
  return streak;
}

// ====== UI Core ======
function updateStepper(screenId){
  const map={"screen-home":1,"screen-profile":2,"screen-goal":3,"screen-target":4,"screen-plan":5,"screen-player":5,"screen-library":5};
  const n=map[screenId]||1;
  ["s1","s2","s3","s4","s5"].forEach((sid,i)=>$(sid).classList.toggle("active", i<n));
}
function showScreen(id){
  screens.forEach(s=>$(s).classList.add("hidden"));
  $(id).classList.remove("hidden");
  updateStepper(id);
}

function setTheme(t){
  state.theme=t;
  document.body.setAttribute("data-theme", t==="light" ? "light" : "dark");
  $("themeBtn").textContent = t==="light" ? "â˜€ï¸" : "ğŸŒ™";
}
function setLang(lang){
  state.lang=lang;
  const isAr=lang==="ar";
  document.documentElement.lang=isAr?"ar":"en";
  document.documentElement.dir=isAr?"rtl":"ltr";
  $("langBtn").textContent=isAr?"AR":"EN";

  const t=I18N[lang];
  for(const k of Object.keys(t)){
    const el=$(k);
    if(el) el.textContent=t[k];
  }

  // buttons texts
  $("quickStartBtn").textContent=t.btnStart;
  $("goProfileBtn").textContent=t.btnStart;
  $("goGoalBtn").textContent=isAr?"Ø§Ù„ØªØ§Ù„ÙŠ":"Next";
  $("goTargetBtn").textContent=isAr?"Ø§Ù„ØªØ§Ù„ÙŠ":"Next";
  $("generateBtn").textContent=t.generate;
  $("startTodayBtn").textContent=t.btnStart;
  $("editBtn").textContent=t.edit;
  $("libraryBtn").textContent=t.library;
  $("swapBtn").textContent=t.swap;
  $("playBtn").textContent=t.btnStart;
  $("nextBtn").textContent=t.btnNext;
  $("stopBtn").textContent=t.btnStop;
  $("backPlan").textContent=t.btnBackPlan;
  $("backPlan2").textContent=t.btnBack;
  $("logBtn").textContent=t.log;

  if(state.weekPlan?.length) renderPlan();
  if(!$("#screen-player").classList.contains("hidden")) renderCurrentExercise();
}

// ===== BMI =====
function bmiFlag(bmi){
  if (bmi == null) return "normal";
  if (bmi >= 30) return "high";
  if (bmi >= 25) return "mid";
  if (bmi < 18.5) return "low";
  return "normal";
}
function computeBMI(){
  const h=Number($("heightCm").value);
  const w=Number($("weightKg").value);
  if(!h||!w) return null;
  const hm=h/100;
  const bmi=w/(hm*hm);
  return Math.round(bmi*10)/10;
}
function updateBMIUI(){
  const bmi=computeBMI();
  state.profile.bmi=bmi;
  state.profile.bmiFlag=bmiFlag(bmi);
  $("bmiText").textContent=bmi ? `${bmi} (${state.profile.bmiFlag})` : "â€”";
}

// ===== Sounds (WebAudio) =====
function beep(freq=880, ms=120){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.type="sine";
    o.frequency.value=freq;
    g.gain.value=0.06;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    setTimeout(()=>{o.stop();ctx.close();}, ms);
  }catch(e){}
}
function beepThree(){ beep(740,90); setTimeout(()=>beep(740,90),140); setTimeout(()=>beep(740,90),280); }
function beepFinish(){ beep(988,140); setTimeout(()=>beep(659,220),180); }

// ===== Matching logic =====
function impactFromAuto(){
  if(state.prefs.impact!=="auto") return state.prefs.impact;
  if(state.profile.bmiFlag==="high") return "low";
  if(state.profile.injury==="knee") return "low";
  return "normal";
}
function allowedExercise(ex){
  if(ex.avoid_if && ex.avoid_if.includes(state.profile.injury)) return false;
  const imp=impactFromAuto();
  if(imp==="low" && ex.impact==="high") return false;
  return true;
}
function matchesPrefs(ex){
  const g=state.prefs.goal;
  const t=state.prefs.target;
  const wt=state.prefs.type;
  const lvl=state.profile.level;

  const goalOk=ex.goals.includes(g);
  const targetOk = (t==="full_body") ? true : (ex.targets.includes(t) || ex.targets.includes("full_body"));

  let typeOk=true;
  if(wt==="cardio") typeOk = ex.type==="cardio";
  if(wt==="bodyweight") typeOk = ex.type==="bodyweight";
  if(wt==="stretching") typeOk = ex.type==="stretching";

  const levelOk=ex.level.includes(lvl);
  return goalOk && targetOk && typeOk && levelOk;
}
function sessionDefaults(ex){
  const mode=state.prefs.mode;
  const lvl=state.profile.level;

  let work=ex.defaults?.work_sec ?? 30;
  let rest=ex.defaults?.rest_sec ?? 20;
  let reps=ex.defaults?.reps ?? 10;
  let sets=ex.defaults?.sets ?? 3;
  let rounds=ex.defaults?.rounds ?? 3;

  if(lvl==="beginner"){ work=Math.max(20,work-5); reps=Math.max(6,reps-2); rest+=10; }
  if(lvl==="advanced"){ work+=10; reps+=4; rest=Math.max(10,rest-5); }

  if(state.profile.bmiFlag==="high"){ work=Math.max(20,work-5); rest+=10; }

  if(mode==="timer") return {mode:"timer", work, rest, rounds};
  return {mode:"reps", reps, sets, rest};
}

function pickExercisesForSession(){
  const pool = EX.filter(ex => allowedExercise(ex) && matchesPrefs(ex));
  const fallback = EX.filter(ex => allowedExercise(ex) && ex.goals.includes(state.prefs.goal));
  const finalPool = pool.length ? pool : fallback;

  const duration=Number(state.prefs.duration);
  let count=6;
  if(duration>=30) count=8;
  if(duration>=45) count=10;
  if(duration<=10) count=4;

  const arr=[...finalPool].sort(()=>Math.random()-0.5);
  return arr.slice(0, Math.min(count, arr.length));
}

// ===== Plan =====
function setGoal(goal){
  state.prefs.goal=goal;
  $("goalChosenText").textContent = `${goal} â€¢ ${state.prefs.duration}min â€¢ ${state.prefs.days}d â€¢ ${state.prefs.mode}`;
}
function makeWeekPlan(){
  const days=Number(state.prefs.days);
  const plan=[];
  for(let i=0;i<days;i++){
    const session=pickExercisesForSession();
    plan.push({day:i+1, session, createdAt:Date.now()});
  }
  state.weekPlan=plan;
  state.todayIndex=0;
  saveState();
  renderPlan();
}
function renderPlan(){
  showScreen("screen-plan");
  $("streakText").textContent = `${getStreak()} day(s)`;

  const list=$("weekList");
  list.innerHTML="";
  state.weekPlan.forEach((d,idx)=>{
    const div=document.createElement("div");
    div.className="weekCard";
    const title = state.lang==="ar" ? `Ø§Ù„ÙŠÙˆÙ… ${d.day}` : `Day ${d.day}`;
    const meta = `${d.session.length} exercises`;
    div.innerHTML = `
      <div class="weekHead">
        <div>
          <div class="weekDay">${title}</div>
          <div class="weekMeta">${meta}</div>
        </div>
      </div>
      <div class="weekBtns">
        <button class="smallBtn" data-idx="${idx}" data-action="preview">${state.lang==="ar"?"Ø¹Ø±Ø¶":"Preview"}</button>
        <button class="smallBtn" data-idx="${idx}" data-action="start">${state.lang==="ar"?"Ø¨Ø¯Ø¡":"Start"}</button>
      </div>
    `;
    list.appendChild(div);
  });

  $("startTodayBtn").onclick = ()=> startPlayer(state.todayIndex);
}

// ===== Player =====
function stopTimer(){
  if(state.player.timer) clearInterval(state.player.timer);
  state.player.timer=null;
  state.player.running=false;
}
function startPlayer(dayIndex){
  state.todayIndex=dayIndex;
  const day=state.weekPlan[dayIndex];
  if(!day) return;

  state.player.workout = day.session.map(ex=>({ex, cfg:sessionDefaults(ex)}));
  state.player.idx=0;
  stopTimer();
  showScreen("screen-player");
  renderCurrentExercise();
}
function renderCurrentExercise(){
  const item=state.player.workout[state.player.idx];
  if(!item){
    logCompletion();
    renderPlan();
    return;
  }

  const ex=item.ex;
  $("playerExerciseName").textContent = state.lang==="ar" ? ex.name_ar : ex.name_en;
  $("playerMeta").textContent = `${ex.type} â€¢ ${ex.targets.join(", ")}`;
  $("playerIllu").innerHTML = ex.illustration;
  $("tipsText").textContent = state.lang==="ar" ? ex.tips_ar : ex.tips_en;

  // reset ring + animation classes
  const ring=$("ring");
  ring.style.setProperty("--p","0%");
  ring.classList.remove("flashDone");

  const svg = $("playerIllu").querySelector("svg");
  if(svg){
    svg.classList.remove("illuFadeOut");
    svg.classList.add("illuFadeIn");
    setTimeout(()=>svg.classList.remove("illuFadeIn"),220);
  }

  const c=$("counter");
  c.classList.remove("pulse3");

  if(item.cfg.mode==="timer"){
    state.player.phase="work";
    state.player.totalPhase=item.cfg.work;
    state.player.remaining=item.cfg.work;
    $("counter").textContent=String(state.player.remaining);
    $("counterHint").textContent = state.lang==="ar"
      ? `Ø¹Ù…Ù„ ${item.cfg.work}s â€¢ Ø±Ø§Ø­Ø© ${item.cfg.rest}s`
      : `Work ${item.cfg.work}s â€¢ Rest ${item.cfg.rest}s`;
    $("playBtn").textContent = state.lang==="ar" ? "Ø§Ø¨Ø¯Ø£" : "Start";
  }else{
    $("counter").textContent = `${item.cfg.reps}x${item.cfg.sets}`;
    $("counterHint").textContent = state.lang==="ar"
      ? `ØªÙƒØ±Ø§Ø±: ${item.cfg.reps} Ã— ${item.cfg.sets} â€¢ Ø±Ø§Ø­Ø© ${item.cfg.rest}s (Ø§Ø¶ØºØ· Next Ø¨Ø¹Ø¯ Ù…Ø§ ØªØ®Ù„Øµ)`
      : `Reps: ${item.cfg.reps} Ã— ${item.cfg.sets} â€¢ rest ${item.cfg.rest}s (press Next when done)`;
    $("playBtn").textContent = state.lang==="ar" ? "Ø¬Ø§Ù‡Ø² âœ…" : "Ready âœ…";
  }
}

function startOrResume(){
  const item=state.player.workout[state.player.idx];
  if(!item) return;

  // unlock audio on iOS
  beep(1,1);

  if(item.cfg.mode==="reps"){
    // manual mode
    return;
  }

  if(state.player.running) return;
  state.player.running=true;

  let phase=state.player.phase;
  let remaining=state.player.remaining;

  $("playBtn").textContent = state.lang==="ar" ? "Ø¬Ø§Ø±ÙŠ..." : "Running...";

  state.player.timer = setInterval(()=>{
    remaining -= 1;
    state.player.remaining = remaining;
    $("counter").textContent = String(remaining);

    // Progress ring
    const total = (phase==="work") ? item.cfg.work : item.cfg.rest;
    const p = Math.max(0, Math.min(100, ((total - remaining) / total) * 100));
    $("ring").style.setProperty("--p", `${p}%`);

    // Pulse last 3 seconds
    if(remaining <= 3 && remaining > 0){
      $("counter").classList.add("pulse3");
      if(remaining === 3) beepThree();
    } else {
      $("counter").classList.remove("pulse3");
    }

    if(remaining <= 0){
      // phase transition
      if(phase==="work"){
        beepFinish();
        $("ring").classList.add("flashDone");
        setTimeout(()=>$("ring").classList.remove("flashDone"),650);

        phase="rest";
        remaining=item.cfg.rest;
        state.player.phase="rest";
        state.player.remaining=remaining;

        $("counterHint").textContent = state.lang==="ar" ? `Ø±Ø§Ø­Ø© ${item.cfg.rest}s` : `Rest ${item.cfg.rest}s`;
        if(remaining === 0) moveNext();
      } else {
        moveNext();
      }
    }
  }, 1000);
}

function moveNext(){
  stopTimer();
  const svg = $("playerIllu").querySelector("svg");
  if(svg) svg.classList.add("illuFadeOut");

  setTimeout(()=>{
    state.player.idx += 1;
    if(state.player.idx >= state.player.workout.length){
      logCompletion();
      renderPlan();
      return;
    }
    renderCurrentExercise();
  }, 160);
}

function swapExercise(){
  const item=state.player.workout[state.player.idx];
  if(!item) return;
  const currentId=item.ex.id;

  const pool = EX
    .filter(ex => ex.id !== currentId)
    .filter(ex => allowedExercise(ex) && matchesPrefs(ex));

  if(!pool.length) return;

  const svg = $("playerIllu").querySelector("svg");
  if(svg) svg.classList.add("illuFadeOut");

  setTimeout(()=>{
    const replacement=pool[Math.floor(Math.random()*pool.length)];
    state.player.workout[state.player.idx] = {ex:replacement, cfg:sessionDefaults(replacement)};
    renderCurrentExercise();
  }, 160);
}

// ===== Library =====
function buildLibraryFilters(){
  $("libGoal").innerHTML = `
    <option value="all">All</option>
    <option value="fat_loss">Fat loss</option>
    <option value="muscle_gain">Muscle</option>
    <option value="cardio">Cardio</option>
    <option value="mobility">Mobility</option>
    <option value="stretching">Stretch</option>
    <option value="maintain">Maintain</option>
  `;
  $("libTarget").innerHTML = `
    <option value="all">All</option>
    <option value="full_body">Full body</option>
    <option value="core">Core</option>
    <option value="chest">Chest</option>
    <option value="back">Back</option>
    <option value="shoulders">Shoulders</option>
    <option value="arms">Arms</option>
    <option value="legs">Legs</option>
    <option value="glutes">Glutes</option>
  `;
  $("libType").innerHTML = `
    <option value="all">All</option>
    <option value="bodyweight">Bodyweight</option>
    <option value="cardio">Cardio</option>
    <option value="stretching">Stretching</option>
  `;
  $("libLevel").innerHTML = `
    <option value="all">All</option>
    <option value="beginner">Beginner</option>
    <option value="intermediate">Intermediate</option>
    <option value="advanced">Advanced</option>
  `;
}
function renderLibrary(){
  showScreen("screen-library");
  buildLibraryFilters();

  $("libApply").onclick = ()=>{
    const g=$("libGoal").value;
    const t=$("libTarget").value;
    const ty=$("libType").value;
    const lv=$("libLevel").value;

    const list=$("libList");
    list.innerHTML="";

    const filtered = EX.filter(ex=>{
      if(!allowedExercise(ex)) return false;
      if(g!=="all" && !ex.goals.includes(g)) return false;
      if(t!=="all" && !(ex.targets.includes(t) || ex.targets.includes("full_body"))) return false;
      if(ty!=="all" && ex.type !== ty) return false;
      if(lv!=="all" && !ex.level.includes(lv)) return false;
      return true;
    });

    filtered.forEach(ex=>{
      const div=document.createElement("div");
      div.className="libItem";
      div.innerHTML=`
        <div class="libHead">
          <div>
            <div class="weekDay">${state.lang==="ar"?ex.name_ar:ex.name_en}</div>
            <div class="weekMeta">${ex.type} â€¢ ${ex.targets.join(", ")}</div>
          </div>
          <button class="smallBtn">${state.lang==="ar"?"Ø¹Ø±Ø¶":"View"}</button>
        </div>
      `;
      div.querySelector("button").onclick = ()=>{
        state.player.workout=[{ex, cfg:sessionDefaults(ex)}];
        state.player.idx=0;
        showScreen("screen-player");
        renderCurrentExercise();
      };
      list.appendChild(div);
    });
  };

  $("libApply").click();
}

// ===== Wire UI =====
function wireUI(){
  $("langBtn").onclick = ()=>{ setLang(state.lang==="ar"?"en":"ar"); saveState(); };
  $("themeBtn").onclick = ()=>{ setTheme(state.theme==="dark"?"light":"dark"); saveState(); };

  $("btnMen").onclick = ()=>{ state.section="men"; showScreen("screen-profile"); saveState(); };
  $("btnWomen").onclick = ()=>{ state.section="women"; showScreen("screen-profile"); saveState(); };

  $("quickStartBtn").onclick = ()=>{
    // quick: cardio 10 min full body
    state.prefs.goal="cardio";
    state.prefs.duration=10;
    state.prefs.days=3;
    state.prefs.mode="timer";
    state.prefs.target="full_body";
    state.prefs.type="cardio";
    makeWeekPlan();
    startPlayer(0);
  };

  $("goProfileBtn").onclick = ()=> showScreen("screen-profile");
  $("backHome1").onclick = ()=> showScreen("screen-home");
  $("backHome2").onclick = ()=> showScreen("screen-home");

  $("heightCm").addEventListener("input", updateBMIUI);
  $("weightKg").addEventListener("input", updateBMIUI);

  $("goGoalBtn").onclick = ()=>{
    state.profile.heightCm = Number($("heightCm").value) || null;
    state.profile.weightKg = Number($("weightKg").value) || null;
    state.profile.age = Number($("age").value) || null;
    state.profile.level = $("level").value;
    state.profile.injury = $("injury").value;
    state.profile.activity = $("activity").value;
    updateBMIUI();
    showScreen("screen-goal");
    saveState();
  };

  document.querySelectorAll(".goal").forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll(".goal").forEach(b=>b.classList.remove("selected"));
      btn.classList.add("selected");
      setGoal(btn.dataset.goal);
      saveState();
    };
  });

  $("duration").onchange = ()=>{ state.prefs.duration=Number($("duration").value); if(state.prefs.goal) setGoal(state.prefs.goal); saveState(); };
  $("days").onchange = ()=>{ state.prefs.days=Number($("days").value); if(state.prefs.goal) setGoal(state.prefs.goal); saveState(); };
  $("mode").onchange = ()=>{ state.prefs.mode=$("mode").value; if(state.prefs.goal) setGoal(state.prefs.goal); saveState(); };
  $("impact").onchange = ()=>{ state.prefs.impact=$("impact").value; saveState(); };

  $("goTargetBtn").onclick = ()=>{
    if(!state.prefs.goal){
      alert(I18N[state.lang].chooseGoal);
      return;
    }
    showScreen("screen-target");
  };

  document.querySelectorAll(".target").forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll(".target").forEach(b=>b.classList.remove("selected"));
      btn.classList.add("selected");
      state.prefs.target=btn.dataset.target;
      saveState();
    };
  });
  $("tFull").classList.add("selected");

  $("workoutType").onchange = ()=>{ state.prefs.type=$("workoutType").value; saveState(); };
  $("equipment").onchange = ()=>{ state.prefs.equipment=$("equipment").value; saveState(); };

  $("generateBtn").onclick = ()=> makeWeekPlan();
  $("backGoal").onclick = ()=> showScreen("screen-goal");

  $("weekList").addEventListener("click",(e)=>{
    const btn=e.target.closest("button");
    if(!btn) return;
    const idx=Number(btn.dataset.idx);
    const action=btn.dataset.action;
    if(action==="preview"){
      const day=state.weekPlan[idx];
      alert(day.session.map(x => (state.lang==="ar"?x.name_ar:x.name_en)).join("\n"));
    }
    if(action==="start") startPlayer(idx);
  });

  $("editBtn").onclick = ()=> showScreen("screen-goal");
  $("libraryBtn").onclick = ()=> renderLibrary();

  $("playBtn").onclick = ()=> startOrResume();
  $("nextBtn").onclick = ()=> moveNext();
  $("stopBtn").onclick = ()=>{ stopTimer(); renderCurrentExercise(); };
  $("swapBtn").onclick = ()=> swapExercise();

  $("backPlan").onclick = ()=>{ stopTimer(); renderPlan(); };
  $("backPlan2").onclick = ()=> renderPlan();
  $("logBtn").onclick = ()=> logCompletion();
}

// ===== init =====
(function init(){
  loadState();

  setTheme(state.theme || "dark");
  setLang(state.lang || "ar");

  // restore profile inputs
  if(state.profile?.heightCm) $("heightCm").value = state.profile.heightCm;
  if(state.profile?.weightKg) $("weightKg").value = state.profile.weightKg;
  if(state.profile?.age) $("age").value = state.profile.age;
  if(state.profile?.level) $("level").value = state.profile.level;
  if(state.profile?.injury) $("injury").value = state.profile.injury;
  if(state.profile?.activity) $("activity").value = state.profile.activity;

  // restore prefs inputs
  $("duration").value = String(state.prefs?.duration ?? 20);
  $("days").value = String(state.prefs?.days ?? 4);
  $("mode").value = state.prefs?.mode ?? "timer";
  $("impact").value = state.prefs?.impact ?? "auto";
  $("workoutType").value = state.prefs?.type ?? "mix";

  if(state.prefs?.goal){
    // mark selected goal card
    document.querySelectorAll(".goal").forEach(b=>{
      b.classList.toggle("selected", b.dataset.goal===state.prefs.goal);
    });
    setGoal(state.prefs.goal);
  }else{
    $("goalChosenText").textContent="â€”";
  }

  updateBMIUI();
  wireUI();

  if(state.weekPlan?.length) renderPlan();
  else showScreen("screen-home");
})();
</script>
</body>
</html>
